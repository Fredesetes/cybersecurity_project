import{j as g,d as _,b4 as j,_ as L,c as D,w as b,o as H,D as U,a as S,Q as M,G as T}from"./index.45fde4bc.js";import{Q as V}from"./QPage.6494c224.js";function l(a){return typeof a=="function"?a:()=>a}const G={url:[Function,String],method:{type:[Function,String],default:"POST"},fieldName:{type:[Function,String],default:()=>a=>a.name},headers:[Function,Array],formFields:[Function,Array],withCredentials:[Function,Boolean],sendRaw:[Function,Boolean],batch:[Function,Boolean],factory:Function},O=["factory-failed","uploaded","failed","uploading"];function X({props:a,emit:s,helpers:n}){const v=g([]),r=g([]),i=g(0),x=_(()=>({url:l(a.url),method:l(a.method),headers:l(a.headers),formFields:l(a.formFields),fieldName:l(a.fieldName),withCredentials:l(a.withCredentials),sendRaw:l(a.sendRaw),batch:l(a.batch)})),$=_(()=>i.value>0),P=_(()=>r.value.length>0);let F;function A(){v.value.forEach(e=>{e.abort()}),r.value.length>0&&(F=!0)}function I(){const e=n.queuedFiles.value.slice(0);n.queuedFiles.value=[],x.value.batch(e)?k(e):e.forEach(u=>{k([u])})}function k(e){if(i.value++,typeof a.factory!="function"){w(e,{});return}const u=a.factory(e);if(!u)s("factory-failed",new Error("QUploader: factory() does not return properly"),e),i.value--;else if(typeof u.catch=="function"&&typeof u.then=="function"){r.value.push(u);const c=o=>{n.isAlive()===!0&&(r.value=r.value.filter(d=>d!==u),r.value.length===0&&(F=!1),n.queuedFiles.value=n.queuedFiles.value.concat(e),e.forEach(d=>{n.updateFileStatus(d,"failed")}),s("factory-failed",o,e),i.value--)};u.then(o=>{F===!0?c(new Error("Aborted")):n.isAlive()===!0&&(r.value=r.value.filter(d=>d!==u),w(e,o))}).catch(c)}else w(e,u||{})}function w(e,u){const c=new FormData,o=new XMLHttpRequest,d=(t,p)=>u[t]!==void 0?l(u[t])(p):x.value[t](p),q=d("url",e);if(!q){console.error("q-uploader: invalid or no URL specified"),i.value--;return}const z=d("formFields",e);z!==void 0&&z.forEach(t=>{c.append(t.name,t.value)});let E=0,B=0,h=0,C=0,N;o.upload.addEventListener("progress",t=>{if(N===!0)return;const p=Math.min(C,t.loaded);n.uploadedSize.value+=p-h,h=p;let m=h-B;for(let y=E;m>0&&y<e.length;y++){const f=e[y];if(m>f.size)m-=f.size,E++,B+=f.size,n.updateFileStatus(f,"uploading",f.size);else{n.updateFileStatus(f,"uploading",m);return}}},!1),o.onreadystatechange=()=>{o.readyState<4||(o.status&&o.status<400?(n.uploadedFiles.value=n.uploadedFiles.value.concat(e),e.forEach(t=>{n.updateFileStatus(t,"uploaded")}),s("uploaded",{files:e,xhr:o})):(N=!0,n.uploadedSize.value-=h,n.queuedFiles.value=n.queuedFiles.value.concat(e),e.forEach(t=>{n.updateFileStatus(t,"failed")}),s("failed",{files:e,xhr:o})),i.value--,v.value=v.value.filter(t=>t!==o))},o.open(d("method",e),q),d("withCredentials",e)===!0&&(o.withCredentials=!0);const Q=d("headers",e);Q!==void 0&&Q.forEach(t=>{o.setRequestHeader(t.name,t.value)});const R=d("sendRaw",e);e.forEach(t=>{n.updateFileStatus(t,"uploading",0),R!==!0&&c.append(d("fieldName",t),t,t.name),t.xhr=o,t.__abort=()=>{o.abort()},C+=t.size}),s("uploading",{files:e,xhr:o}),v.value.push(o),R===!0?o.send(new Blob(e)):o.send(c)}return{isUploading:$,isBusy:P,abort:A,upload:I}}var J={name:"QUploader",props:G,emits:O,injectPlugin:X},K=j(J);const W={name:"Import",data(){return{uploadUrl:`${this.$server}/networks/import`}},computed:{token(){var a;return(a=this.$store.getters.token)!=null?a:""}},methods:{async onUploaded({xhr:a}){await this.$store.dispatch("loadNetworks"),this.$notify.create({message:"Networks Imported with Success!",color:"blue",icon:"done"})}}},Y=U("div",{class:"row justify-between"},[U("h5",{class:"column q-my-xs text-bold text-dark"},"Import Networks")],-1),Z={class:"row column q-py-sm"};function ee(a,s,n,v,r,i){return H(),D(V,{padding:""},{default:b(()=>[Y,U("div",Z,[S(T,null,{default:b(()=>[S(M,null,{default:b(()=>[S(K,{url:r.uploadUrl,headers:[{name:"Authorization",value:`Bearer ${this.token}`}],onUploaded:i.onUploaded,label:"Upload file",accept:".csv","field-name":"networks_file",flat:"",bordered:"",style:{width:"100%"}},null,8,["url","headers","onUploaded"])]),_:1})]),_:1})])]),_:1})}var ne=L(W,[["render",ee]]);export{ne as default};
